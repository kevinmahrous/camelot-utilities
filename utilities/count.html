<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Counting - Camelot Utilities</title>
    <link href="../output.css" rel="stylesheet" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../favicon-16x16.png"
    />
    <link rel="manifest" href="../site.webmanifest" />
  </head>
  <body class="font-inter bg-white dark:bg-gray-800">
    <nav
      class="grid grid-cols-3 md:grid-cols-[auto_1fr_auto_auto_auto_auto] items-center p-4"
    >
      <span
        class="col-span-3 md:col-span-1 text-center md:text-left select-none text-2xl bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-blue-800 font-bold dark:from-blue-400 dark:to-blue-600"
      >
        Counting Utility
      </span>
      <div class="hidden md:flex col-span-1"></div>
      <a
        href="../index.html"
        class="text-lg p-2 md:p-4 text-blue-600 dark:hover:text-blue-300 dark:text-blue-400 font-bold hover:text-blue-800 transition-colors text-center"
        >Home</a
      >
      <a
        href="./join.html"
        class="text-lg p-2 md:p-4 text-blue-600 dark:hover:text-blue-300 dark:text-blue-400 font-bold hover:text-blue-800 transition-colors text-center"
        >Join</a
      >
      <a
        href="./separate.html"
        class="text-lg p-2 md:p-4 text-blue-600 dark:hover:text-blue-300 dark:text-blue-400 font-bold hover:text-blue-800 transition-colors text-center"
        >Separate</a
      >
      <a
        id="theme-toggle"
        type="button"
        class="text-blue-600 dark:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-500 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5"
      >
        <svg
          id="theme-toggle-dark-icon"
          class="hidden w-5 h-5"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
          ></path>
        </svg>
        <svg
          id="theme-toggle-light-icon"
          class="hidden w-5 h-5"
          fill="currentColor"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
            fill-rule="evenodd"
            clip-rule="evenodd"
          ></path>
        </svg>
      </a>
    </nav>

    <section
      class="flex flex-col items-center justify-center h-[calc(100vh-20vh)] gap-4"
    >
      <textarea
        placeholder="Insert a list of characters that's copied from Camelot."
        id="area"
        class="w-3/4 h-[calc(100vh-30vh)] rounded-lg border border-2 border-blue-200 dark:border-blue-800 px-3 py-2 hover:border-blue-900 focus:outline-none focus:ring focus:ring-blue-800/40 active:ring active:ring-blue-800/40"
      ></textarea>
      <div class="flex flex-row gap-4 w-3/4 justify-center items-center">
        <button
          id="count"
          class="w-auto rounded-lg px-4 py-2 bg-blue-500 hover:bg-blue-800 text-white focus:outline-none focus:ring focus:ring-blue-800/40 active:ring active:ring-blue-800/40"
        >
          Count
        </button>
        <button
          id="paste"
          class="w-auto rounded-lg px-4 py-2 bg-green-500 hover:bg-green-800 text-white focus:outline-none focus:ring focus:ring-green-800/40 active:ring active:ring-green-800/40"
        >
          Paste
        </button>
      </div>
    </section>

    <section
      id="output-section"
      class="hidden h-[calc(100vh-20vh)] flex flex-col items-center justify-center gap-4"
    >
      <h2
        class="select-none mt-4 text-3xl bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-blue-800 font-bold dark:from-blue-400 dark:to-blue-600"
      >
        Count
      </h2>
      <div
        id="output-container"
        class="w-3/4 max-h-[60vh] overflow-y-auto rounded-lg border border-2 border-blue-200 dark:border-blue-800 px-3 py-2 hover:border-blue-900 focus:outline-none focus:ring focus:ring-blue-800/40 active:ring active:ring-blue-800/40 bg-white"
      ></div>
      <p
        id="total"
        class="text-xl select-none mt-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-blue-800 font-bold dark:from-blue-400 dark:to-blue-600"
      ></p>
      <div class="flex gap-4 w-3/4 items-center justify-center">
        <button
          id="clear"
          class="w-auto rounded-lg px-4 py-2 bg-red-500 hover:bg-red-800 text-white focus:outline-none focus:ring focus:ring-red-800/40 active:ring active:ring-red-800/40"
        >
          Clear
        </button>
        <button
          id="copy"
          class="w-auto rounded-lg px-4 py-2 bg-green-500 hover:bg-green-800 text-white focus:outline-none focus:ring focus:ring-green-800/40 active:ring active:ring-green-800/40"
        >
          Copy
        </button>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        if (
          localStorage.getItem("color-theme") === "dark" ||
          (!("color-theme" in localStorage) &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }

        const themeToggleDarkIcon = document.getElementById(
          "theme-toggle-dark-icon"
        );
        const themeToggleLightIcon = document.getElementById(
          "theme-toggle-light-icon"
        );

        if (
          localStorage.getItem("color-theme") === "dark" ||
          (!("color-theme" in localStorage) &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          themeToggleLightIcon.classList.remove("hidden");
        } else {
          themeToggleDarkIcon.classList.remove("hidden");
        }

        const themeToggleBtn = document.getElementById("theme-toggle");

        themeToggleBtn.addEventListener("click", function () {
          themeToggleDarkIcon.classList.toggle("hidden");
          themeToggleLightIcon.classList.toggle("hidden");

          if (document.documentElement.classList.contains("dark")) {
            document.documentElement.classList.remove("dark");
            localStorage.setItem("color-theme", "light");
          } else {
            document.documentElement.classList.add("dark");
            localStorage.setItem("color-theme", "dark");
          }
        });

        const textarea = document.getElementById("area");
        const countButton = document.getElementById("count");
        const pasteButton = document.getElementById("paste");
        const outputSection = document.getElementById("output-section");
        const outputContainer = document.getElementById("output-container");
        const totalElement = document.getElementById("total");
        const clearButton = document.getElementById("clear");
        const copyButton = document.getElementById("copy");
        textarea.focus();

        countButton.addEventListener("click", function () {
          const input = textarea.value.trim();
          if (input == "") {
            textarea.setCustomValidity(
              "It's required to add something, dummy!"
            );
            textarea.reportValidity();
            return;
          } else {
            const items = new Map();

            input.split(/\n|,/).forEach((line) => {
              if (line.includes("|")) {
                const [item, quantity] = line
                  .split("|")
                  .map((part) => part.trim());
                if (item) {
                  const qty =
                    parseInt(quantity?.replace(/x/, "").trim(), 10) || 1;
                  if (!items.has(item)) {
                    items.set(item, 0);
                  }
                  items.set(item, items.get(item) + qty);
                }
              } else {
                const item = line.trim();
                if (item) {
                  const qty = 1;
                  if (!items.has(item)) {
                    items.set(item, 0);
                  }
                  items.set(item, items.get(item) + qty);
                }
              }
            });

            const sortedItems = Array.from(items.entries()).sort(
              (a, b) => b[1] - a[1]
            );

            outputContainer.innerHTML = sortedItems
              .map(([item, qty]) => `<p>${item}: ${qty}</p>`)
              .join("");

            const total = sortedItems.reduce((sum, [, qty]) => sum + qty, 0);
            totalElement.textContent = `Total: ${total}`;

            outputSection.classList.remove("hidden");
            outputSection.scrollIntoView({ behavior: "smooth" });
          }
        });

        pasteButton.addEventListener("click", async function () {
          try {
            const text = await navigator.clipboard.readText();
            const trimmedText = text.trim();

            if (textarea.value) {
              textarea.value += "\n" + trimmedText;
            } else {
              textarea.value = trimmedText;
            }

            textarea.focus();
          } catch (error) {
            console.error("Failed to read clipboard contents: ", error);
          }
        });

        clearButton.addEventListener("click", function () {
          textarea.value = "";
          outputContainer.innerHTML = "";
          totalElement.textContent = "";
          outputSection.classList.add("hidden");

          setTimeout(() => {
            textarea.scrollIntoView({ behavior: "smooth" });
          }, 300);
        });

        copyButton.addEventListener("click", function () {
          const text =
            outputContainer.textContent + "\n" + totalElement.textContent;
          navigator.clipboard.writeText(text).then(() => {
            console.log("Copied!");
          });
        });
      });
    </script>
  </body>
</html>
